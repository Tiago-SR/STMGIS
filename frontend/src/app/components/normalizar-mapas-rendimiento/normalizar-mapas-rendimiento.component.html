<div class="container mx-auto p-4">
  <h2 class="text-xl font-semibold mb-4 text-center">Normalización de Mapas de Rendimiento - {{ cultivo?.nombre }}</h2>
  
  <div id="viewDiv" style="height: 450px;" class="mb-4"></div>

  <div *ngIf="mapaReferencia && mapaActual">
    <!-- Grid container para las dos cards -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <!-- Card Mapa Referencia -->
      <div class="p-4 bg-white rounded shadow">
        <div class="flex justify-between items-center mb-4">
          <h4 class="font-semibold text-md">Mapa Referencia (Acumulado)</h4>
          <span class="text-sm text-gray-600">{{ puntosReferencia | number }} puntos</span>
        </div>

        <div class="flex justify-between items-center mb-4">
          <label class="text-sm font-medium text-gray-700">Coeficiente de Ajuste (Referencia):</label>
          <span class="font-medium">{{ coeficienteAjusteReferencia | number:'1.2-2' }}</span>
        </div>
        
        <div class="grid grid-cols-2 gap-4 py-3">
          <!-- Recuadro Percentil 80 -->
          <div class="border rounded p-3">
            <div class="flex justify-between mb-2">
              <span class="text-sm text-gray-600">Percentil 80:</span>
              <span class="font-medium">{{ percentil80Referencia | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Coeficiente sugerido (P80):</span>
              <span class="font-medium">{{ coeficienteSugeridoReferencia | number:'1.2-2' }}</span>
            </div>
          </div>
          <!-- Recuadro Mediana -->
          <div class="border rounded p-3">
            <div class="flex justify-between mb-2">
              <span class="text-sm text-gray-600">Mediana:</span>
              <span class="font-medium">{{ medianaReferencia | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Coeficiente sugerido (Med):</span>
              <span class="font-medium">{{ coeficienteSugeridoMedianaReferencia | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Card Mapa Actual -->
      <div class="p-4 bg-white rounded shadow">
        <div class="flex justify-between items-center mb-4">
          <h4 class="font-semibold text-md">{{ nombreMapaActual }}</h4>
          <span class="text-sm text-gray-600">{{ puntosActual | number }} puntos</span>
        </div>

        <div class="flex justify-between items-center gap-2 mb-4">
          <label class="text-sm font-medium text-gray-700 whitespace-nowrap">
            Coeficiente de Ajuste (Actual):
          </label>
          <div class="flex gap-2">
            <input type="number" 
                   
                   step="0.01" 
                   [(ngModel)]="coeficienteAjusteActual" 
                   (change)="formatearCoeficiente()" 
                   class="w-32 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" />

            <button (click)="previsualizarMapa()" 
                    class="px-4 py-1 bg-green-300 text-gray-700 rounded hover:bg-green-600">
              Previsualizar
            </button>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <!-- Recuadro Percentil 80 -->
          <div class="border rounded p-3">
            <div class="flex justify-between mb-2">
              <span class="text-sm text-gray-600">Percentil 80:</span>
              <span class="font-medium">{{ percentil80Actual | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Coeficiente sugerido (P80):</span>
              <span class="font-medium">{{ coeficienteSugeridoActual | number:'1.2-2' }}</span>
            </div>
          </div>
          <!-- Recuadro Mediana -->
          <div class="border rounded p-3">
            <div class="flex justify-between mb-2">
              <span class="text-sm text-gray-600">Mediana:</span>
              <span class="font-medium">{{ medianaActual | number:'1.2-2' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-600">Coeficiente sugerido (Med):</span>
              <span class="font-medium">{{ coeficienteSugeridoMedianas | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button (click)="confirmarNormalizacion()" 
            class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
      Confirmar Normalización
    </button>
  </div>
</div>